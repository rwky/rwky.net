
server {
    listen 80;
    server_name rwky.net;
    rewrite ^ https://rwky.net$uri;
}

server {
    listen 80 default_server;
    rewrite ^ https://www.rwky.net$uri;
}

server {
    listen 443 ssl http2 default_server;
    ssl_certificate /home/app/config/rwky.net.wild.crt;
    ssl_certificate_key /home/app/config/rwky.net.wild.key;
    # HSTS (ngx_http_headers_module is required) (63072000 seconds = 2 years)
    add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload";

    rewrite ^ https://www.rwky.net$uri;
}

server {
    listen 443 ssl http2;
    server_name www.rwky.net;
    root /home/app/public;
    ssl_certificate /home/app/config/rwky.net.wild.crt;
    ssl_certificate_key /home/app/config/rwky.net.wild.key;

    # HSTS (ngx_http_headers_module is required) (63072000 seconds = 2 years)
    add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload";

    passenger_enabled on;

    location ~* ^/(js|css)/[0-9]+/([a-z]+)\.(js|css)$ {
        etag on;
        expires max;
        try_files /$1/$2.$3 =404;
        passenger_enabled off;
    }

}

passenger_pre_start https://www.rwky.net/;


